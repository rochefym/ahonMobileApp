<app-header></app-header>

<ion-content [fullscreen]="true">
  <div class="history-page-container">
    <!-- ... existing filter controls ... -->
    
    <!-- Mission List -->
    <div class="mission-list" *ngIf="(missions$ | async) as missions">
      <ion-card 
        *ngFor="let mission of missions; trackBy: trackMissionById"
        class="mission-card"
        [class.expanded]="expandedMissionId === mission.id"
        (click)="toggleMissionExpansion(mission.id)">
        
        <!-- Mission Header -->
        <ion-card-header class="mission-header">
          <div class="mission-info">
            <div class="mission-date">
              <ion-icon name="calendar-outline"></ion-icon>
              <span>{{ mission.date_time_started | date:'MMM dd, yyyy' }}</span>
            </div>
            <div class="mission-duration">
              <ion-icon name="time-outline"></ion-icon>
              <span>{{ mission.duration }}</span>
            </div>
          </div>
          
          <div class="mission-stats">
            <div class="mission-status" [class]="'status-' + mission.status.toLowerCase()">
              <ion-icon [name]="getStatusIcon(mission)"></ion-icon>
              <span>{{ mission.status }}</span>
            </div>
            <div class="victims-count">
              <ion-icon name="people-outline"></ion-icon>
              <span>{{ mission.victims_found }} found</span>
            </div>
          </div>
        </ion-card-header>
        
        <!-- Mission Content -->
        <ion-card-content class="mission-content" *ngIf="expandedMissionId === mission.id">
          <div class="mission-summary">
            <div class="summary-item">
              <span class="label">Mission ID:</span>
              <span class="value">{{ mission.mission_id_str }}</span>
            </div>
            <div class="summary-item">
              <span class="label">Detection Model:</span>
              <span class="value">{{ mission.detection_model | titlecase }}</span>
            </div>
            <div class="summary-item">
              <span class="label">Confidence Threshold:</span>
              <span class="value">{{ mission.confidence_threshold }}%</span>
            </div>
          </div>
          
          <!-- Expanded Details -->
          <div class="mission-details">
            <div class="details-section">
              <h4>Detection Details</h4>
              <div class="detection-summary">
                <div class="detection-item">
                  <span class="label">Total Detections:</span>
                  <span class="value">{{ mission.total_detections }}</span>
                </div>
                <div class="detection-item">
                  <span class="label">Average Confidence:</span>
                  <span class="value">{{ mission.average_confidence }}%</span>
                </div>
                <div class="detection-item">
                  <span class="label">Temperature Range:</span>
                  <span class="value">{{ mission.temperature_range }}</span>
                </div>
              </div>
            </div>
            
            <div class="details-section" *ngIf="mission.victims && mission.victims.length > 0">
              <h4>Victims Found</h4>
              <div class="victims-list">
                <div 
                  *ngFor="let victim of mission.victims"
                  class="victim-item">
                  <div class="victim-info">
                    <div class="victim-id">Victim #{{ victim.victim_id_str }}</div>
                    <div class="victim-details">
                      <span class="victim-status" [class]="'status-' + victim.status.toLowerCase()">
                        {{ victim.status }}
                      </span>
                      <span class="victim-temp">{{ victim.temperature }}Â°C</span>
                      <span class="victim-confidence">{{ victim.confidence }}%</span>
                    </div>
                  </div>
                  <!-- ... victim actions ... -->
                </div>
              </div>
            </div>
            
            <div class="details-section">
              <h4>Mission Actions</h4>
              <div class="action-buttons">
                <ion-button 
                  fill="outline" 
                  size="small" 
                  (click)="exportMission(mission, $event)">
                  <ion-icon name="download-outline" slot="start"></ion-icon>
                  Export Report
                </ion-button>
                <ion-button 
                  fill="outline" 
                  size="small" 
                  color="danger"
                  (click)="deleteMission(mission.id, $event)">
                  <ion-icon name="trash-outline" slot="start"></ion-icon>
                  Delete
                </ion-button>
              </div>
            </div>
          </div>
        </ion-card-content>
      </ion-card>
    </div>

    <!-- Empty State -->
    <div class="empty-state" *ngIf="!(missions$ | async)?.length">
      <ion-icon name="document-text-outline" size="large"></ion-icon>
      <h3>No Mission History</h3>
      <p>Start a new mission to see your history here.</p>
    </div>
    
  </div>
</ion-content>